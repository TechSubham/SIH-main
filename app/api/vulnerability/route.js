// import { connectToDatabase } from '@/lib/db';

// export async function GET(request) {
//   try {
//     const { db } = await connectToDatabase();
//     const collection = db.collection('vulnerability');

//     const vulnerabilities = await collection
//       .find({})
//       .project({ cve_id: 1, publish_date: 1, description: 1, severity: 1, _id: 0 })
//       .toArray();

//     return new Response(JSON.stringify(vulnerabilities), {
//       headers: { 'Content-Type': 'application/json' },
//       status: 200,
//     });
//   } catch (error) {
//     return new Response(JSON.stringify({ error: error.message }), {
//       headers: { 'Content-Type': 'application/json' },
//       status: 500,
//     });
//   }
// }


import { connectToDatabase } from '@/lib/db';

export async function GET(request) {
  try {
    const { db } = await connectToDatabase();
    const collection = db.collection('vulnerability');

    const vulnerabilities = await collection
      .find({})
      .project({ cve_id: 1, published_date: 1, description: 1, severity: 1, _id: 0 })
      .toArray();

    console.log('Fetched vulnerabilities:', JSON.stringify(vulnerabilities.slice(0, 2), null, 2));

    return new Response(JSON.stringify(vulnerabilities), {
      headers: { 'Content-Type': 'application/json' },
      status: 200,
    });
  } catch (error) {
    console.error('Error in API route:', error);
    return new Response(JSON.stringify({ error: error.message }), {
      headers: { 'Content-Type': 'application/json' },
      status: 500,
    });
  }
}